<!-- Button trigger modal -->

<h2 class='mb-3'> Historique des consultations</h2>
<% old_consultations = @consultations.select { |consultation| consultation.date < DateTime.now } %>
<% new_consultations = @consultations.select { |consultation| consultation.date >= DateTime.now } %>

<h3 class='mb-3'>Consultations à venir</h3>
<% new_consultations.each do |consultation| %>
  <div class='row'>
    <div class='col-sm-6'>
      <%= link_to "#", data: {toggle: "modal", target: "#exampleModal-#{consultation.id}"}, class: 'color-link' do %>
        <div class='card-product justify-content-between my-2' id='history-card'>
          <h4><%= consultation.title %></h4>
          <p class="mr-2"><%= consultation.date.strftime("%d/%m/%Y") %>
          à <%= consultation.date.strftime("%H:%M") %></p>
        </div>
      <% end %>
    </div>
  </div> 
<% end %>

<h3 class='mb-3'>Consultations passées</h3>
<% old_consultations.each do |consultation| %>
  <div class='row'>
      <div class='col-sm-6'>
        <%= link_to "#", data: {toggle: "modal", target: "#exampleModal-#{consultation.id}"}, class: 'color-link' do %>
          <div class='card-product-new card-product justify-content-between my-2' id='history-card'>
              <h4><%= consultation.title %></h4>
              <p class="mr-2"><%= consultation.date.strftime("%d/%m/%Y") %>
              à <%= consultation.date.strftime("%H:%M") %></p>
          </div>
        <% end %>
      </div>
    </div> 
<% end %>


<% @consultations.each do |consultation| %>
  <!-- Modal -->
  <div class="modal fade" id="exampleModal-<%= consultation.id %>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel"><%= consultation.title%> le<br><%= consultation.date.strftime("%d/%m/%Y") %><%= " à " %><%= consultation.date.strftime("%H:%M") %></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <% unless consultation.date > DateTime.now %>


            <h5>Rapport du médecin</h5>
            <%= consultation.public_report %>

            <hr class="style1 mx-auto my-4">

            <% if current_user.doctor? %>

              <h5>Notes privés</h5>
              <%= consultation.private_report %>
              <% prescriptions = consultation.consultation_medications %>

              <hr class="style1 mx-auto my-4">

              <h5><%= "Prescription de médicaments" %></h5>
              <% prescriptions.each do |prescription| %>

                  <%= prescription.medication.name %>
                  <%= prescription.quantity %>
                  <%= prescription.description %>

              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
<% end %>